# Night Theme Switcher Gnome Shell extension
#
# Copyright (C) 2020 Romain Vigier
#
# This program is free software: you can redistribute it and/or modify it under
# the terms of the GNU General Public License as published by the Free Software
# Foundation, either version 3 of the License, or (at your option) any later
# version.
#
# This program is distributed in the hope that it will be useful, but WITHOUT
# ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS
# FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License along with
# this program. If not, see <http s ://www.gnu.org/licenses/>.


stages:
  - test
  - build

test:
  stage: test
  image: node:latest
  rules:
    - changes:
      - src/**/*
      - tests/**/*
  cache:
    paths:
      - node_modules
  script:
    - make deps-install
    - make test

build:
  stage: build
  image: fedora:latest
  rules:
    - if: $CI_COMMIT_TAG
    - if: $CI_JOB_MANUAL
  cache:
    paths:
      - .dnf_cache
  script:
    - mkdir -p .dnf_cache
    - dnf --setopt=cachedir=$(pwd)/.dnf_cache --setopt=keepcache=True update -y
    - dnf --setopt=cachedir=$(pwd)/.dnf_cache --setopt=keepcache=True install -y make gnome-shell gettext
    - make build
  artifacts:
    name: "$CI_COMMIT_REF_NAME"
    expose_as: "extension"
    paths:
      - build/nightthemeswitcher@romainvigier.fr.shell-extension.zip
